version: "3.8"

services:
  mysql:
    image: mysql:8.0
    container_name: exam-mysql
    restart: always
    environment:
      # 本地开发环境密码，生产环境请通过环境变量覆盖
      MYSQL_ROOT_PASSWORD: rootpass
      MYSQL_DATABASE: exam
      TZ: Asia/Shanghai
    ports:
      # 左边是宿主机端口，右边是容器内 MySQL 端口
      # 为避免与本机已安装的 MySQL(3306) 冲突，这里使用 13306 作为宿主机端口
      - "13306:3306"
    volumes:
      # MySQL 数据持久化卷
      - exam-mysql-data:/var/lib/mysql
      # 初始化 SQL（挂载项目根目录下的 sql/，用于 schema.sql、data.sql）
      - ../sql:/docker-entrypoint-initdb.d

  redis:
    image: redis:7-alpine
    container_name: exam-redis
    restart: always
    command: ["redis-server", "--appendonly", "yes"]
    ports:
      # 左边是宿主机端口，右边是容器内 Redis 端口
      # 为避免与本机已安装的 Redis(6379) 冲突，这里使用 16379 作为宿主机端口
      - "16379:6379"
    volumes:
      # Redis 数据持久化卷
      - exam-redis-data:/data

volumes:
  exam-mysql-data:
  exam-redis-data:


